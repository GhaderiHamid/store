<?php

namespace App\Http\Controllers\User;

use App\Http\Controllers\Controller;
use App\Models\Comment;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class CommentController extends Controller
{
    public function store(Request $request, $productId)
    {
        $validatedData = $request->validate([
            'comment_text' => 'required|string|max:1000',
        ]);

        // مقدار را به‌عنوان متن استخراج کنید
        $commentText = $validatedData['comment_text'];

        // ارسال به تابع تحلیل متن
        $analysis = $this->analyzeComment($commentText);

        Comment::create([
            'user_id' => Auth::id(),
            'product_id' => $productId,
            'comment_text' => $commentText, // ذخیره رشته صحیح
            'analysis' => json_encode($analysis)
        ]);

        return redirect()->back()->with('success', 'دیدگاه شما با موفقیت ثبت شد.');
    }

    public function index()
    {
        $comments = Comment::with('product')->where('user_id', auth()->id())->get();
        return view('frontend.comment.all', compact('comments'));
    }

    public function destroy($id)
    {
        $comment = Comment::where('id', $id)->where('user_id', Auth::id())->firstOrFail();
        $comment->delete();

        return redirect()->back()->with('success', 'دیدگاه شما با موفقیت حذف شد.');
    }

    public function edit($id)
    {
        $comment = Comment::where('id', $id)->where('user_id', Auth::id())->firstOrFail();
        return view('frontend.comment.edit', compact('comment'));
    }

    public function update(Request $request, $id)
    {
        $request->validate([
            'comment_text' => 'required|string|max:1000',
        ]);

        $comment = Comment::where('id', $id)->where('user_id', Auth::id())->firstOrFail();
        $comment->update([
            'comment_text' => $request->input('comment_text'),
        ]);

        return redirect()->route('comments.index')->with('success', 'دیدگاه شما با موفقیت ویرایش شد.');
    }
    public function analyzeComment($comment_text)
    {


        $positives = [
            'خوب',
            'عالی',
            'جذاب',
            'مناسب',
            'ارزش خرید بالا',
            'با کیفیت',
            'بادوام',
            'محکم',
            'زیبا',
            'کاربردی',
            'راحت',
            'طراحی زیبا',
            'پرفروش',
            'مقاوم',
            'قیمت مناسب',
            'عملکرد بالا',
            'مقرون به صرفه',
            'بی‌نظیر',
            'به‌صرفه',
            'قابلیت تنظیم',
            'پشتیبانی خوب',
            'کلاسیک',
            'پیشرفته',
            'خلاقانه',
            'مدرن',
            'هوشمند',
            'ظریف',
            'دوام بالا',
            'سبک',
            'سرعت بالا',
            'قدرت بالا',
            'چندکاره',
            'انعطاف‌پذیر',
            'حرفه‌ای',
            'نرم',
            'پرکاربرد',
            'مقاومت عالی',
            'کیفیت ممتاز',
            'کاربرپسند',
            'ضد ضربه',
            'بسیار کاربردی',
            'بهینه',
            'کامل و جامع',
            'عملکرد فوق‌العاده',
            'فن قدرتمند',
            'کاهش دما',
            'طراحی ارگونومیک',
            'اتصال پایدار',
            'سازگاری عالی',
            'عمر طولانی باتری',
            'استفاده آسان',
            'صفحه‌کلید نرم',
            'نور پس‌زمینه RGB',
            'دقت بالا',
            'سرعت پردازش بالا',
            'حرارت پایین',
            'خنک‌کنندگی عالی',
            'بدنه مقاوم',
            'هارد پرسرعت',
            'رم با ظرفیت بالا',
            'شارژ سریع',
            'نمایشگر شفاف',
            'وضوح بالا',
            'صدای قدرتمند',
            'کیبورد مکانیکی',
            'سازگاری با سیستم‌های مختلف',
            'پورت‌های کافی',
            'ساپورت گیمینگ',
            'مناسب برای برنامه‌نویسان',
            'طول عمر بالا',
            'عملکرد نرم و روان',
            'سریع و قدرتمند',
            'کارت گرافیک قدرتمند',
            'پشتیبانی از جدیدترین نرم‌افزارها',
            'استفاده بدون مشکل',
            'کیفیت تصویر عالی',
            'وضوح رنگ بالا',
            'تاخیر کم',
            'انتقال داده سریع',
            'کابل بادوام',
            'پشتیبانی از 4K',
            'ارتباط بی‌سیم سریع',
            'بدنه آلومینیومی مقاوم',
            'سازگار با انواع سیستم‌عامل‌ها',
            'طراحی زیبا و مدرن',
            'مقاوم در برابر خط و خش',
            'نسبت به قیمت عالی',
            'دارای استاندارد جهانی',
            'مناسب برای گیمرها',
            'حس راحتی و ارگونومی',
            'قابلیت اورکلاک',
            'کیفیت صدای فوق‌العاده',
            'ظاهری شیک',
            'دارای نورپردازی پیشرفته',
            'فناوری کاهش نویز',
            'پشتیبانی از اتصال چندگانه',
            'پایداری شبکه',
            'انتقال اطلاعات سریع',
            'مجهز به فناوری جدید',
            'کم مصرف',
            'وزن سبک',
            'دارای گارانتی معتبر',
            'بدون لگ',
            'قیمت منطقی',
            'کمک‌کننده در روزمره',
            'پشتیبانی از قابلیت‌های جدید',
            'کابل ضد پارگی',
            'کیفیت ساخت استاندارد',
            'کمترین نویز در اتصال',
            'انعطاف کابل بالا',
            'پورت USB-C',
            'سرعت خواندن و نوشتن بالا',
            'ظرفیت حافظه بالا',
            'سرعت عملکرد عالی',
            'عایق‌بندی مناسب',
            'ساخت مقاوم',
            'دارای ویژگی‌های منحصربه‌فرد',
            'عملکرد بی‌نظیر',
            'دارای قابلیت‌های ویژه',
            'بهترین انتخاب',
            'برتر نسبت به رقبا'
        ];
        $negatives = [
            'مشکل',
            'ضعف',
            'نامناسب',
            'نیاز به حوصله',
            'بی‌کیفیت',
            'گران',
            'کارایی پایین',
            'سخت نصب شدن',
            'تعمیر دشوار',
            'خراب شد',
            'کوچک‌تر از انتظار',
            'نامطمئن',
            'سرعت پایین',
            'طراحی نامناسب',
            'وزن زیاد',
            'نامرغوب',
            'کاربرد محدود',
            'پشتیبانی ضعیف',
            'کند',
            'بسیار گران',
            'قیمت غیرمنطقی',
            'ارزش خرید ندارد',
            'گران‌تر از انتظار',
            'هزینه بالا',
            'بی‌ارزش نسبت به قیمت',
            'هزینه زیاد',
            'ارزش پایینی دارد',
            'نمی‌ارزد',
            'گران بدون دلیل',
            'قیمت ناعادلانه',
            'پرداخت بیش از حد',
            'خیلی گرونه',
            'به قیمتش نمی‌ارزد',
            'نقص در طراحی',
            'چندان راحت نیست',
            'عدم پایداری اتصال',
            'تاخیر بالا',
            'نویز زیاد',
            'افت کیفیت',
            'طول عمر کوتاه',
            'کمتر از انتظار',
            'سرعت پایین پردازش',
            'بالا رفتن دما',
            'کیفیت تصویر پایین',
            'مشکلات در نصب و راه‌اندازی',
            'بدنه حساس به ضربه',
            'باتری ضعیف',
            'سرعت شارژ کم',
            'عدم تطابق با مشخصات',
            'وزن زیاد',
            'افت عملکرد پس از مدتی',
            'عدم انتقال داده سریع',
            'عدم سازگاری با برخی سیستم‌عامل‌ها',
            'کابل شکننده',
            'فقدان تنظیمات پیشرفته',
            'نداشتن نور پس‌زمینه مناسب',
            'عدم پشتیبانی مناسب',
            'محدودیت‌های شدید',
            'عدم کیفیت صدا',
            'عملکرد نامطلوب در گیمینگ',
            'تاخیر ورودی زیاد',
            'عدم ارائه درایورهای مناسب',
            'عدم مقاومت در برابر خط و خش',
            'اتصال ضعیف',
            'قطع شدن ناگهانی اتصال',
            'نقص در عملکرد فن',
            'صدای بیش از حد بلند',
            'عدم سازگاری با درگاه USB-C',
            'نقص در قطعات داخلی',
            'محدودیت تنظیم روشنایی صفحه',
            'حجم زیاد نرم‌افزارهای اضافی',
            'عدم امکان ارتقا',
            'مصرف برق بالا',
            'قطع و وصل مکرر اتصال بی‌سیم',
            'عدم عملکرد صحیح در دمای بالا',
            'پشتیبانی از نرم‌افزارهای محدود',
            'قدرت پردازشی پایین',
            'عملکرد کند در پردازش‌های سنگین',
            'مناسب نبودن برای ادیت و طراحی',
            'سازگاری ضعیف با نرم‌افزارها',
            'نداشتن قابلیت ضد آب',
            'طراحی غیرارگونومیک',
            'نامناسب برای استفاده طولانی',
            'عدم وجود پورت‌های کافی',
            'عدم پایداری در اتصال شبکه',
            'سرعت خواندن و نوشتن کم',
            'ایجاد حرارت بیش از حد',
            'نقص در درایورها',
            'عدم انتقال دقیق رنگ‌ها',
            'عدم مقاومت در برابر گرد و غبار',
            'نداشتن گارانتی معتبر',
            'نیاز به تعمیرات مکرر',
            'عدم تناسب قیمت با کیفیت',
            'قطع شدن اتصال پس از مدتی',
            'ضعف در اورکلاک',
            'عدم پشتیبانی از ورژن جدید',
            'پشتیبانی ناکافی نرم‌افزاری',
            'کمبود کابل‌های همراه',
            'کیفیت ساخت پایین',
            'عملکرد نامناسب در پردازش تصاویر'
        ];

        $positiveMatches = [];
        $negativeMatches = [];

        foreach ($positives as $word) {
            if (strpos($comment_text, $word) !== false) {
                $positiveMatches[] = $word;
            }
        }

        foreach ($negatives as $word) {
            if (strpos($comment_text, $word) !== false) {
                $negativeMatches[] = $word;
            }
        }

        return [
            'positives' => $positiveMatches,
            'negatives' => $negativeMatches
        ];
    }
   
}
